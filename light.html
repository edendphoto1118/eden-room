<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Sculptor Pro | EDEN LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        serif: ['Cinzel', 'serif'], 
                        mono: ['Space Mono', 'monospace'],
                        zh: ['Shippori Mincho', 'serif'] 
                    },
                    colors: { eden: { gold: '#D4AF37' } }
                }
            }
        }
    </script>

    <style>
        /* åŸºç¤è¨­å®š */
        body { background-color: #050505; color: #C0C0C0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* 3D ç•«å¸ƒèƒŒæ™¯ - æ”¹äº®ä¸€é»çš„æ·±ç°ï¼Œå¢åŠ å°æ¯” */
        #canvas-wrapper { position: relative; flex: 1; width: 100%; min-height: 0; background: radial-gradient(circle at center, #2a2a2a 0%, #000000 100%); }
        #canvas-element { width: 100%; height: 100%; display: block; }
        
        /* UI å®¹å™¨ - é—œéµï¼šå…è¨±æ»‘é¼ ç©¿é€å®¹å™¨ï¼Œä½†æ””æˆªæŒ‰éˆ•é»æ“Š */
        #ui-container { 
            position: relative; z-index: 20; flex-shrink: 0; 
            background: #080808; border-top: 1px solid #333;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* å°èˆªåˆ— */
        #navbar { position: absolute; top: 0; left: 0; width: 100%; z-index: 30; pointer-events: none; }
        /* è®“å…§éƒ¨å…ƒç´ å¯é»æ“Š */
        #navbar a, #navbar button, .interactive { pointer-events: auto; cursor: pointer; }

        /* æ»‘æ¡¿ */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; padding: 10px 0; cursor: pointer; pointer-events: auto; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; 
            background: #D4AF37; margin-top: -7px; border: 1px solid #fff; 
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.8); border-radius: 50%;
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; cursor: pointer; background: #444; }

        /* ç‡ˆå…‰åˆ‡æ›æ¨™ç±¤ */
        .tab-btn {
            font-family: 'Cinzel', serif; font-size: 12px; letter-spacing: 0.1em; color: #666; font-weight: bold;
            padding: 14px 0; cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent; text-align: center; flex: 1;
            background: #0a0a0a; pointer-events: auto; /* å¼·åˆ¶å¯é» */
        }
        .tab-btn:hover { background: #111; color: #aaa; }
        .tab-btn.active { color: #D4AF37; border-bottom: 3px solid #D4AF37; background: #151515; }
        
        /* é…ä»¶æŒ‰éˆ• */
        .mod-btn {
            border: 1px solid #333; color: #777; font-family: 'Space Mono'; font-size: 10px;
            padding: 10px 0; text-align: center; cursor: pointer; transition: all 0.2s; background: #0a0a0a;
            pointer-events: auto; /* å¼·åˆ¶å¯é» */
        }
        .mod-btn:hover { border-color: #666; color: #eee; background: #111; }
        .mod-btn.active { border-color: #D4AF37; background: rgba(212, 175, 55, 0.15); color: #D4AF37; font-weight: bold; border-width: 1px; }

        /* è‡‰å‹æŒ‰éˆ• */
        .face-shape-btn {
            width: 28px; height: 28px; border: 1px solid #444; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: 0.2s; background: rgba(0,0,0,0.5); pointer-events: auto;
        }
        .face-shape-btn:hover { border-color: #888; background: rgba(255,255,255,0.1); }
        .face-shape-btn.active { border-color: #D4AF37; background: rgba(212, 175, 55, 0.2); box-shadow: 0 0 8px rgba(212,175,55,0.3); }
        .face-shape-icon { width: 12px; height: 12px; border: 1px solid #aaa; border-radius: 50%; transition: 0.3s; }
        .face-shape-btn.active .face-shape-icon { border-color: #D4AF37; background: #D4AF37; }

        /* é–‹é—œ */
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; pointer-events: auto; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider-tg {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333; transition: .3s; border-radius: 20px; border: 1px solid #444;
        }
        .slider-tg:before {
            position: absolute; content: ""; height: 14px; width: 14px; left: 2px; bottom: 2px;
            background-color: #888; transition: .3s; border-radius: 50%;
        }
        input:checked + .slider-tg { background-color: #111; border-color: #D4AF37; }
        input:checked + .slider-tg:before { transform: translateX(20px); background-color: #D4AF37; }

        /* èªè¨€åˆ‡æ› */
        body.lang-en .text-zh { display: none; }
        body.lang-zh .text-en { display: none; }
        body.lang-zh { font-family: 'Shippori Mincho', serif; letter-spacing: 0.05em; font-weight: 500; }
    </style>
</head>
<body class="lang-en transition-colors duration-500">

    <div id="canvas-wrapper">
        <nav id="navbar" class="flex justify-between items-center px-6 py-4">
            <a href="index.html" class="text-[10px] tracking-[0.2em] text-[#888] hover:text-[#fff] transition-colors font-mono interactive">â† EDEN ROOM</a>
            
            <div class="flex gap-4 items-center">
                <div class="flex gap-3 border-r border-[#444] pr-4 mr-1">
                    <div class="face-shape-btn" id="shapeOval" onclick="window.setFaceShape('oval')" title="OVAL"><div class="face-shape-icon" style="transform: scale(0.8, 1.2);"></div></div>
                    <div class="face-shape-btn active" id="shapeRound" onclick="window.setFaceShape('round')" title="ROUND"><div class="face-shape-icon" style="transform: scale(1, 1);"></div></div>
                    <div class="face-shape-btn" id="shapeWide" onclick="window.setFaceShape('wide')" title="WIDE"><div class="face-shape-icon" style="transform: scale(1.2, 0.9);"></div></div>
                </div>
                <button onclick="window.toggleLang()" class="border border-[#444] px-3 py-1 text-[9px] font-mono hover:border-[#D4AF37] hover:text-[#D4AF37] transition-colors text-[#888] bg-black/50 backdrop-blur interactive">
                    <span class="text-en">ä¸­ / EN</span><span class="text-zh">EN / ä¸­</span>
                </button>
            </div>
        </nav>
        
        <canvas id="canvas-element"></canvas>
    </div>

    <div id="ui-container">
        <main class="w-full max-w-3xl mx-auto px-6 pt-2 pb-6">
            
            <div class="flex justify-between border-b border-[#222] mb-6 bg-[#050505]">
                <div id="tabKey" class="tab-btn active" onclick="window.selectLight('key')"><span class="text-en">KEY</span><span class="text-zh">ä¸»å…‰</span></div>
                <div id="tabFill" class="tab-btn" onclick="window.selectLight('fill')"><span class="text-en">FILL</span><span class="text-zh">è£œå…‰</span></div>
                <div id="tabRim" class="tab-btn" onclick="window.selectLight('rim')"><span class="text-en">RIM</span><span class="text-zh">è¼ªå»“</span></div>
            </div>

            <div id="controlPanel" class="space-y-6 transition-opacity duration-200">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                    <div class="flex items-center justify-between border-b border-[#333] pb-2">
                        <span class="font-serif text-[10px] text-gray-400 tracking-widest">
                            <span class="text-en">STATUS</span><span class="text-zh">é›»æº</span>
                        </span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="powerSwitch" checked onchange="window.toggleCurrentLight(this.checked)">
                            <span class="slider-tg"></span>
                        </label>
                    </div>
                    
                    <div class="flex gap-2 items-center">
                        <span class="font-serif text-[10px] text-gray-400 tracking-widest w-16">
                            <span class="text-en">MODIFIER</span><span class="text-zh">é…ä»¶</span>
                        </span>
                        <div class="flex-1 grid grid-cols-4 gap-2">
                            <div class="mod-btn active" id="mod-softbox" onclick="window.setModifier('softbox')">SOFT</div>
                            <div class="mod-btn" id="mod-radar" onclick="window.setModifier('radar')">RADAR</div>
                            <div class="mod-btn" id="mod-grid" onclick="window.setModifier('grid')">GRID</div>
                            <div class="mod-btn" id="mod-bare" onclick="window.setModifier('bare')">BARE</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="font-serif text-[10px] text-gray-400 tracking-widest"><span class="text-en">AZIMUTH</span><span class="text-zh">æ–¹ä½è§’</span></span>
                            <span id="azVal" class="font-mono text-[10px] text-[#D4AF37]">45Â°</span>
                        </div>
                        <input type="range" id="azSlider" min="-180" max="180" step="5" oninput="window.updateAzimuth(this.value)">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="font-serif text-[10px] text-gray-400 tracking-widest"><span class="text-en">ALTITUDE</span><span class="text-zh">é«˜åº¦è§’</span></span>
                            <span id="polVal" class="font-mono text-[10px] text-[#D4AF37]">30Â°</span>
                        </div>
                        <input type="range" id="polSlider" min="-40" max="90" step="5" oninput="window.updateAltitude(this.value)">
                    </div>
                </div>

                <div class="border-t border-[#222] pt-3 text-center md:text-left flex flex-col md:flex-row items-baseline gap-4">
                    <h3 class="font-serif text-[#D4AF37] text-sm tracking-widest font-bold min-w-[120px]" id="lightName">REMBRANDT</h3>
                    <p class="font-zh text-xs text-gray-400 font-light leading-relaxed" id="lightDesc">...</p>
                </div>

            </div>
        </main>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. SETUP ---
        const canvas = document.getElementById('canvas-element');
        const canvasWrapper = document.getElementById('canvas-wrapper');
        
        const scene = new THREE.Scene();
        // é¡é ­è¨­ç½®
        const camera = new THREE.PerspectiveCamera(35, canvasWrapper.clientWidth / canvasWrapper.clientHeight, 0.1, 100);
        camera.position.set(0, 0.1, 8); 
        camera.lookAt(0, -0.2, 0);

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
        
        // ğŸ”¥ é—œéµè¨­ç½®ï¼šé«˜æ›å…‰ ToneMapping
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.5; // æ›å…‰æ‹‰é«˜ 50%

        // --- 2. GEOMETRY (é«˜è³ªæ„Ÿå¹¾ä½•çŸ³è†) ---
        const headGroup = new THREE.Group();
        scene.add(headGroup);

        // æè³ªï¼šç´”ç™½ï¼Œä½ç²—ç³™åº¦ (å¢åŠ åå…‰)ï¼Œé«˜å°æ¯”
        const plasterMat = new THREE.MeshStandardMaterial({
            color: 0xffffff,
            roughness: 0.4, // é™åˆ° 0.4 è®“é«˜å…‰æ›´æ˜é¡¯
            metalness: 0.05,
            flatShading: false
        });

        // çµæ§‹çµ„è£ (Sphere + Cone + Torus)
        const head = new THREE.Mesh(new THREE.SphereGeometry(1.4, 64, 64), plasterMat);
        head.scale.set(0.85, 1.15, 0.95);
        head.castShadow = true; head.receiveShadow = true;
        headGroup.add(head);

        // é¼»å­
        const nose = new THREE.Mesh(new THREE.ConeGeometry(0.28, 1.15, 32), plasterMat);
        nose.position.set(0, -0.1, 1.35);
        nose.rotation.x = -0.1;
        nose.scale.z = 0.55;
        nose.castShadow = true; nose.receiveShadow = true;
        headGroup.add(nose);

        // çœ‰éª¨
        const brow = new THREE.Mesh(new THREE.TorusGeometry(0.6, 0.15, 16, 32, 2.5), plasterMat);
        brow.rotation.z = -Math.PI / 2 + 1.25;
        brow.rotation.x = 0.5;
        brow.position.set(0, 0.4, 1.05);
        brow.castShadow = true; brow.receiveShadow = true;
        headGroup.add(brow);

        // è€³æœµ
        const earL = new THREE.Mesh(new THREE.CapsuleGeometry(0.25, 0.5, 4, 16), plasterMat);
        earL.position.set(-1.45, -0.1, 0); earL.castShadow = true; earL.receiveShadow = true;
        headGroup.add(earL);
        const earR = earL.clone();
        earR.position.set(1.45, -0.1, 0); headGroup.add(earR);

        // è„–å­
        const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.65, 0.85, 2.5, 32), plasterMat);
        neck.position.y = -2; neck.castShadow = true; neck.receiveShadow = true;
        headGroup.add(neck);

        // åœ°æ¿
        const plane = new THREE.Mesh(new THREE.PlaneGeometry(50, 50), new THREE.MeshStandardMaterial({ color: 0x0a0a0a, roughness: 1 }));
        plane.rotation.x = -Math.PI / 2; plane.position.y = -3.5; plane.receiveShadow = true;
        scene.add(plane);

        // ğŸ”¥ é—œéµè¨­ç½®ï¼šè¶…äº®ç’°å¢ƒå…‰ (0.6)ï¼Œä¿è­‰çµ•å°ä¸é»‘
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); 
        scene.add(ambientLight);

        // --- 3. LIGHTS DATA ---
        const lightsData = {
            // ä¸»å…‰ï¼šå¼·åº¦æ‹‰åˆ° 3.0
            key: { obj: null, az: 45, pol: 30, on: true, name: "KEY", modifier: 'softbox', color: 0xffffff, intensity: 3.0 },
            fill: { obj: null, az: -45, pol: 10, on: true, name: "FILL", modifier: 'softbox', color: 0xffeedd, intensity: 0.8 },
            rim: { obj: null, az: 135, pol: 30, on: true, name: "RIM", modifier: 'bare', color: 0xffc266, intensity: 3.5 }
        };

        for (const k in lightsData) {
            const data = lightsData[k];
            const light = new THREE.SpotLight(data.color, data.intensity);
            light.castShadow = true;
            light.shadow.mapSize.set(2048, 2048);
            light.shadow.bias = -0.00005; // ä¿®æ­£æ¢ç´‹
            scene.add(light);
            light.target.position.set(0, 0, 0);
            scene.add(light.target);
            data.obj = light;
        }

        // --- 4. GLOBAL INTERACTION FUNCTIONS ---
        // å°‡å‡½æ•¸æ›è¼‰åˆ° windowï¼Œç¢ºä¿ HTML onclick èƒ½è®€å–åˆ°
        let currentTarget = 'key';
        let currentLang = 'en';

        const els = {
            azSlider: document.getElementById('azSlider'),
            polSlider: document.getElementById('polSlider'),
            powerSwitch: document.getElementById('powerSwitch'),
            azVal: document.getElementById('azVal'),
            polVal: document.getElementById('polVal'),
            lightName: document.getElementById('lightName'),
            lightDesc: document.getElementById('lightDesc'),
            panel: document.getElementById('controlPanel')
        };

        window.selectLight = (type) => {
            currentTarget = type;
            // Update Tab UI
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
            updateUI();
        };

        window.updateAzimuth = (val) => {
            lightsData[currentTarget].az = parseInt(val);
            updateLightState();
            updateUI(); // åªæ›´æ–°æ–‡å­—
        };

        window.updateAltitude = (val) => {
            lightsData[currentTarget].pol = parseInt(val);
            updateLightState();
            updateUI();
        };

        window.toggleCurrentLight = (isChecked) => {
            lightsData[currentTarget].on = isChecked;
            updateLightState();
            updateUI();
        };

        window.setModifier = (mod) => {
            lightsData[currentTarget].modifier = mod;
            updateLightState();
            updateUI();
        };

        window.setFaceShape = (shape) => {
            document.querySelectorAll('.face-shape-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('shape' + shape.charAt(0).toUpperCase() + shape.slice(1)).classList.add('active');
            
            // ç‰©ç†è®Šå½¢
            if (shape === 'round') headGroup.scale.set(1, 1, 1);
            else if (shape === 'oval') headGroup.scale.set(0.9, 1.15, 0.95);
            else if (shape === 'wide') headGroup.scale.set(1.15, 0.9, 1.05);
        };

        window.toggleLang = () => {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            document.body.className = document.body.className.replace(/lang-\w+/, `lang-${currentLang}`);
            analyze();
        };

        // æ ¸å¿ƒæ›´æ–°é‚è¼¯
        function updateLightState() {
            const data = lightsData[currentTarget];
            const light = data.obj;
            light.visible = data.on;
            
            if (data.on) {
                const r = 7;
                const phi = (90 - data.pol) * (Math.PI / 180);
                const theta = (data.az + 90) * (Math.PI / 180);
                light.position.set(-(r * Math.sin(phi) * Math.cos(theta)), r * Math.cos(phi), r * Math.sin(phi) * Math.sin(theta));
                
                // é…ä»¶ç‰©ç†æ¨¡æ“¬ (å·®ç•°åŒ–)
                if (data.modifier === 'softbox') { 
                    light.angle = 1.2; light.penumbra = 1.0; light.intensity = data.name === 'RIM' ? 3.5 : 3.0; // æŸ”å…‰ç¶­æŒåŸå¼·åº¦
                }
                else if (data.modifier === 'radar') { 
                    light.angle = 0.7; light.penumbra = 0.4; light.intensity = data.name === 'RIM' ? 4.0 : 3.5; // é›·é”ç¨äº®
                }
                else if (data.modifier === 'grid') { 
                    light.angle = 0.35; light.penumbra = 0.2; light.intensity = data.name === 'RIM' ? 5.0 : 4.5; // èœ‚å·¢èšå…‰è¶…äº®
                }
                else if (data.modifier === 'bare') { 
                    light.angle = 1.3; light.penumbra = 0.05; light.intensity = data.name === 'RIM' ? 4.0 : 3.5; // è£¸ç‡ˆç¡¬å…‰
                }
            }
            analyze();
        }

        function updateUI() {
            const data = lightsData[currentTarget];
            els.azSlider.value = data.az;
            els.polSlider.value = data.pol;
            els.azVal.innerText = `${data.az}Â°`;
            els.polVal.innerText = `${data.pol}Â°`;
            els.powerSwitch.checked = data.on;
            
            // æ›´æ–° Modifier æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.mod-btn').forEach(b => {
                if (b.id === 'mod-' + data.modifier) b.classList.add('active');
                else b.classList.remove('active');
            });

            // ç¦ç”¨æ•ˆæœ
            if (data.on) {
                els.panel.style.opacity = '1';
                els.panel.style.pointerEvents = 'auto';
            } else {
                els.panel.style.opacity = '0.5';
                // ä¿ç•™é–‹é—œå¯é»ï¼Œå…¶ä»–ç¦ç”¨
            }
        }

        // --- RWD Resize ---
        function onResize() {
            const w = canvasWrapper.clientWidth;
            const h = canvasWrapper.clientHeight;
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
        }
        window.addEventListener('resize', onResize);
        setTimeout(onResize, 100);

        // --- Analysis ---
        function analyze() {
            const k = lightsData.key;
            let en = "CUSTOM", zh = "è‡ªå®šç¾©", den = "Unique setup.", dzh = "ç¨ç‰¹ä½ˆå…‰ã€‚";
            if (!k.on) { en = "LOW KEY"; zh = "æš—èª¿"; dzh = "ä¸»å…‰å·²é—œé–‰ã€‚"; }
            else {
                const absAz = Math.abs(k.az);
                if (k.pol > 60) { en = "TOP LIGHT"; zh = "é ‚å…‰"; dzh = "çµæ§‹æ„Ÿå¼·ï¼Œçœ¼çª©é™°å½±æ·±ã€‚"; }
                else if (absAz < 25 && k.pol > 20) { en = "BUTTERFLY"; zh = "è´è¶å…‰"; dzh = "ç¾é¡ä½ˆå…‰ï¼Œä¿®é£¾è‡‰å‹ã€‚"; }
                else if (absAz >= 30 && absAz <= 70) { en = "REMBRANDT"; zh = "å€«å‹ƒæœ—å…‰"; dzh = "ç¶“å…¸å€’ä¸‰è§’å…‰å€ã€‚"; }
                else if (absAz > 70) { en = "SPLIT"; zh = "åˆ†å‰²å…‰"; dzh = "æˆ²åŠ‡æ€§åŠé¢å…‰ã€‚"; }
            }
            els.lightName.innerText = currentLang === 'en' ? en : zh;
            els.lightDesc.innerText = currentLang === 'en' ? den : dzh;
        }

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Init
        updateLightState(); // Apply defaults
        updateUI();
        animate();

    </script>
</body>
</html>
