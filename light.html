<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Light Sculptor | EDEN LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Shippori+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { eden: { gold: '#D4AF37', black: '#050505' } },
                    fontFamily: { serif: ['Cinzel', 'serif'], mono: ['Space Mono', 'monospace'], zh: ['Shippori Mincho', 'serif'] }
                }
            }
        }
    </script>

    <style>
        /* Ê†∏ÂøÉ‰ΩàÂ±Ä */
        body { background-color: #080808; color: #C0C0C0; height: 100dvh; width: 100vw; overflow: hidden; display: flex; flex-direction: column; }

        /* Header */
        header { 
            height: 50px; flex-shrink: 0; z-index: 30; display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; border-bottom: 1px solid #222; background: #080808; 
        }
        .ig-link {
            font-family: 'Space Mono'; font-size: 10px; color: #888; letter-spacing: 0.05em; display: flex; align-items: center; gap: 6px; 
            text-decoration: none; padding: 4px 10px; border: 1px solid #333; border-radius: 4px; transition: 0.3s;
        }
        .ig-link:hover { color: #D4AF37; border-color: #D4AF37; background: #111; }

        /* Main Layout */
        #main-layout { display: flex; flex: 1; min-height: 0; position: relative; flex-direction: column; }
        @media (min-width: 768px) { #main-layout { flex-direction: row; } }

        /* Canvas */
        #canvas-wrapper { 
            flex-grow: 1; position: relative; width: 100%; height: 100%; 
            background: radial-gradient(circle at center, #2a2a2a 0%, #000000 100%); order: 1; 
        }
        canvas { display: block; width: 100%; height: 100%; outline: none; }

        /* Dashboard */
        #dashboard { 
            z-index: 20; background: #0c0c0c; display: flex; flex-direction: column; gap: 12px; 
            width: 100%; flex-shrink: 0; padding: 15px 20px; padding-bottom: max(15px, env(safe-area-inset-bottom)); 
            border-top: 1px solid #222; order: 2; 
        }
        @media (min-width: 768px) {
            #dashboard { width: 380px; height: 100%; border-top: none; border-left: 1px solid #222; padding: 25px; overflow-y: auto; }
        }

        /* UI Elements */
        .preset-row { display: flex; gap: 8px; margin-bottom: 5px; }
        .preset-btn {
            flex: 1; background: #151515; border: 1px solid #333; color: #999; font-family: 'Space Mono'; font-size: 9px; 
            padding: 8px 0; text-align: center; cursor: pointer; transition: 0.2s; border-radius: 2px;
        }
        .preset-btn:hover { border-color: #777; color: #fff; background: #222; }
        .preset-btn:active { background: #D4AF37; color: #000; border-color: #D4AF37; }
        
        .tabs { display: flex; border: 1px solid #333; border-radius: 2px; overflow: hidden; height: 32px; flex-shrink: 0; }
        .tab-btn {
            flex: 1; display: flex; align-items: center; justify-content: center; font-family: 'Cinzel', serif; font-size: 10px; 
            letter-spacing: 0.1em; color: #666; background: #111; cursor: pointer; transition: 0.2s;
        }
        .tab-btn.active { background: #D4AF37; color: #000; font-weight: bold; }

        .slider-row { display: flex; align-items: center; gap: 10px; height: 26px; }
        .slider-label { font-family: 'Space Mono', 'Shippori Mincho'; font-size: 9px; color: #888; width: 65px; letter-spacing: 0.05em; font-weight: 500; }
        .slider-val { font-family: 'Space Mono'; font-size: 9px; color: #D4AF37; width: 35px; text-align: right; }
        
        input[type=range] { -webkit-appearance: none; flex: 1; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; background: #D4AF37; border-radius: 50%; 
            margin-top: -6px; border: 2px solid #000; box-shadow: 0 0 8px rgba(212,175,55,0.6);
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; background: #444; border-radius: 1px; }
        #tempSlider::-webkit-slider-runnable-track { background: linear-gradient(to right, #ffaa00, #ffffff, #88ccff); height: 2px; }

        .status-row { display: flex; justify-content: space-between; align-items: center; height: 24px; margin-bottom: 5px; }
        .status-label { font-family: 'Space Mono', 'Shippori Mincho'; font-size: 10px; color: #aaa; letter-spacing: 0.1em; }
        
        .toggle { position: relative; display: inline-block; width: 32px; height: 16px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider-tg { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .3s; border-radius: 16px; border: 1px solid #555; }
        .slider-tg:before { position: absolute; content: ""; height: 10px; width: 10px; left: 3px; bottom: 3px; background-color: #888; transition: .3s; border-radius: 50%; }
        input:checked + .slider-tg { background-color: #111; border-color: #D4AF37; }
        input:checked + .slider-tg:before { transform: translateX(16px); background-color: #D4AF37; }

        .mod-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .mod-btn {
            border: 1px solid #333; color: #777; font-family: 'Space Mono', 'Shippori Mincho'; font-size: 9px;
            padding: 8px 0; text-align: center; cursor: pointer; transition: all 0.2s; background: #111; border-radius: 2px;
        }
        .mod-btn.active { border-color: #D4AF37; background: rgba(212, 175, 55, 0.15); color: #D4AF37; font-weight: bold; }

        /* Gear */
        .gear-section { border-top: 1px solid #222; margin-top: auto; pt-4; display: flex; gap: 10px; flex-direction: column; }
        @media (min-width: 768px) { .gear-section { gap: 12px; } }
        .gear-card {
            background: #111; border: 1px solid #222; padding: 10px 12px; display: flex; align-items: center; gap: 12px;
            text-decoration: none; transition: 0.3s; border-radius: 4px;
        }
        .gear-card:hover { border-color: #D4AF37; background: #181818; transform: translateY(-1px); }
        .gear-icon { width: 32px; height: 32px; background: #1f1f1f; color: #777; display: flex; align-items: center; justify-content: center; font-size: 14px; border-radius: 4px; }
        .gear-card:hover .gear-icon { color: #D4AF37; background: #2a2a2a; }
        .gear-info h4 { font-family: 'Shippori Mincho', serif; font-size: 11px; color: #ddd; margin-bottom: 2px; font-weight: 500; }
        .gear-info p { font-family: 'Space Mono', monospace; font-size: 9px; color: #777; }
        .gear-arrow { color: #555; font-size: 10px; margin-left: auto; }

        /* Overlays */
        #lighting-data {
            position: absolute; top: 20px; right: 20px; pointer-events: none;
            font-family: 'Space Mono'; font-size: 10px; color: #D4AF37;
            display: flex; flex-direction: column; gap: 4px; opacity: 0.8;
            text-align: right; z-index: 10; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        .data-row { display: flex; gap: 10px; justify-content: flex-end; }
        .data-label { color: #888; }

        #map-label {
            position: absolute; top: 150px; left: 20px; pointer-events: none;
            font-family: 'Space Mono'; font-size: 9px; color: #666; z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="lang-zh">

    <header>
        <div class="flex items-center gap-3">
            <span class="text-[12px] tracking-[0.2em] text-[#D4AF37] font-serif font-bold">EDEN</span>
            <span class="text-[9px] text-[#555] tracking-widest border-l border-[#333] pl-3 hidden md:inline">LIGHT SCULPTOR</span>
        </div>
        <div class="flex items-center gap-4">
            <a href="https://www.instagram.com/eden_d_photo/" target="_blank" class="ig-link">
                design by EDEN_D_PHOTO
            </a>
            <button id="langBtn" onclick="window.toggleLang()" class="border border-[#444] px-2 py-1 text-[9px] font-mono hover:border-[#D4AF37] hover:text-[#D4AF37] transition-colors text-[#888] bg-black/50 backdrop-blur cursor-pointer w-12 text-center">
                EN
            </button>
        </div>
    </header>

    <div id="main-layout">
        <div id="canvas-wrapper">
            <div id="map-label">TOP-DOWN VIEW</div>
            <div id="lighting-data">
                <div class="data-row"><span class="data-label">ANGLE</span><span id="dataAngle">45¬∞</span></div>
                <div class="data-row"><span class="data-label">HEIGHT</span><span id="dataHeight">30¬∞</span></div>
                <div class="data-row"><span class="data-label">TEMP</span><span id="dataTemp">5600K</span></div>
            </div>
            <canvas id="webgl"></canvas>
        </div>

        <footer id="dashboard">
            
            <div class="preset-row">
                <div class="preset-btn" onclick="window.applyPreset('rembrandt')">REMBRANDT</div>
                <div class="preset-btn" onclick="window.applyPreset('butterfly')">BUTTERFLY</div>
                <div class="preset-btn" onclick="window.applyPreset('split')">SPLIT</div>
            </div>

            <div class="tabs">
                <div id="tabKey" class="tab-btn active" onclick="selectLight('key')">‰∏ªÂÖâ</div>
                <div id="tabFill" class="tab-btn" onclick="selectLight('fill')">Ë£úÂÖâ</div>
                <div id="tabRim" class="tab-btn" onclick="selectLight('rim')">Ëº™Âªì</div>
            </div>

            <div class="bg-[#151515] p-3 border border-[#222] rounded-sm">
                <div class="status-row">
                    <span id="labelStatus" class="status-label">ÈõªÊ∫êÈñãÈóú</span>
                    <label class="toggle">
                        <input type="checkbox" id="powerSwitch" checked onchange="toggleLight()">
                        <span class="slider-tg"></span>
                    </label>
                </div>
                <div class="mt-3">
                    <div class="flex justify-between mb-2">
                        <span id="labelMod" class="status-label" style="font-size: 9px; color: #888;">ÊéßÂÖâÈÖç‰ª∂</span>
                    </div>
                    <div class="mod-grid">
                        <div class="mod-btn active" id="mod-softbox" onclick="setModifier('softbox')">ÊüîÂÖâÁΩ©</div>
                        <div class="mod-btn" id="mod-radar" onclick="setModifier('radar')">Èõ∑ÈÅîÁΩ©</div>
                        <div class="mod-btn" id="mod-grid" onclick="setModifier('grid')">ËúÇÂ∑¢</div>
                        <div class="mod-btn" id="mod-bare" onclick="setModifier('bare')">Ë£∏Ááà</div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-3 py-2">
                <div class="slider-row">
                    <span id="labelAz" class="slider-label">Êñπ‰ΩçËßí</span>
                    <input type="range" id="azSlider" min="-180" max="180" step="5" oninput="updateVal()">
                    <span id="azDisplay" class="slider-val">45¬∞</span>
                </div>
                <div class="slider-row">
                    <span id="labelAlt" class="slider-label">È´òÂ∫¶Ëßí</span>
                    <input type="range" id="polSlider" min="-40" max="90" step="5" oninput="updateVal()">
                    <span id="polDisplay" class="slider-val">30¬∞</span>
                </div>
                <div class="slider-row">
                    <span id="labelInt" class="slider-label text-[#D4AF37]">Ëº∏Âá∫Âº∑Â∫¶</span>
                    <input type="range" id="intSlider" min="0" max="10" step="0.1" oninput="updateVal()">
                    <span id="intDisplay" class="slider-val text-[#D4AF37]">5.0</span>
                </div>
                <div class="slider-row">
                    <span id="labelTemp" class="slider-label">Ëâ≤Ê∫´ K</span>
                    <input type="range" id="tempSlider" min="2000" max="9000" step="100" oninput="updateVal()">
                    <span id="tempDisplay" class="slider-val">5600</span>
                </div>
            </div>

            <div class="border-t border-[#222] pt-3">
                <span id="algoTitle" class="text-[#D4AF37] font-serif text-xs font-bold tracking-wider block mb-1">REMBRANDT</span>
                <span id="algoDesc" class="text-[#888] font-zh text-xs block leading-relaxed">Á∂ìÂÖ∏ÂÄ´ÂãÉÊúóÂÖâÔºåÁ´ãÈ´îÊÑüÂº∑„ÄÇ</span>
            </div>

            <div class="gear-section">
                <div id="labelGear" class="text-[9px] font-mono text-[#555] tracking-widest mb-1 pl-1">Â∞àÊ•≠ÊîùÂΩ±Ë£ùÂÇô (AFFILIATE)</div>
                <a href="https://s.shopee.tw/1BG8Bdote6" target="_blank" class="gear-card">
                    <div class="gear-icon"><i class="fas fa-bullseye"></i></div>
                    <div class="gear-info">
                        <h4 id="gear1Title">Â∞àÊ•≠ÂÖâÂ≠∏ÊùüÂÖâÁ≠í</h4>
                        <p id="gear1Desc">Á≤æÊ∫ñÊéßÂÖâ SHAPING LIGHT</p>
                    </div>
                    <i class="fas fa-chevron-right gear-arrow"></i>
                </a>
                <a href="https://s.shopee.tw/5fiXXyefqc" target="_blank" class="gear-card">
                    <div class="gear-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="gear-info">
                        <h4 id="gear2Title">ÈõôËâ≤Ê∫´ËÅöÂÖâÁáà</h4>
                        <p id="gear2Desc">È´òÈ°ØËâ≤ÊÄßÊîùÂΩ±Ê£ö‰∏ªÁáà</p>
                    </div>
                    <i class="fas fa-chevron-right gear-arrow"></i>
                </a>
            </div>
        </footer>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. SETUP ---
        const canvas = document.getElementById('webgl');
        const wrapper = document.getElementById('canvas-wrapper');
        const scene = new THREE.Scene();
        
        // ‰∏ªÊîùÂΩ±Ê©ü
        const mainCamera = new THREE.PerspectiveCamera(40, wrapper.clientWidth / wrapper.clientHeight, 0.1, 100);
        mainCamera.position.set(0, 0.2, 9); // ÊãâÈÅ†
        mainCamera.lookAt(0, -0.3, 0);

        // ‰øØË¶ñÊîùÂΩ±Ê©ü (PIP)
        const topCamera = new THREE.OrthographicCamera(-8, 8, 8, -8, 1, 20);
        topCamera.position.set(0, 12, 0);
        topCamera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
        renderer.setSize(wrapper.clientWidth, wrapper.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        
        // üî• È´òÊõùÂÖâ (High Key)
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 2.0;
        renderer.setScissorTest(true);

        // --- 2. PROCEDURAL FACETED BUST (Á®ãÂºèÂåñÈõïÂàª‰∫∫ÂÉè) ---
        // Ê†∏ÂøÉÈÇèËºØÔºöÂª∫Á´ãÈ´òÈù¢Êï∏ÁêÉÈ´î -> Êï∏Â≠∏ËÆäÂΩ¢È†ÇÈªû -> Â•óÁî® Flat Shading
        const headGroup = new THREE.Group();
        scene.add(headGroup);

        // ÊùêË≥™ÔºöËóùË°ìÁü≥ËÜèÔºå‰øùÁïôÂàáÈù¢ÊÑü
        const plasterMat = new THREE.MeshStandardMaterial({ 
            color: 0xffffff, roughness: 0.4, metalness: 0.1, flatShading: true 
        });
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.8, metalness: 0.2 });
        const wallMat = new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.8, metalness: 0.1 });

        // Sculpting Function
        function createSculptedHead() {
            // Level 3 Icosahedron (~1280 faces) - good for faceted look
            const geometry = new THREE.IcosahedronGeometry(1.6, 3); 
            const pos = geometry.attributes.position;
            const v = new THREE.Vector3();

            for (let i = 0; i < pos.count; i++) {
                v.fromBufferAttribute(pos, i);
                const x = v.x; const y = v.y; const z = v.z;

                // 1. ‰∏ãÂ∑¥ËàáËáâÈ†∞ (Jaw & Cheeks)
                if (y < 0.2 && z > 0) {
                    const narrow = Math.max(0, (Math.abs(x) - 0.5));
                    v.x *= (1 - narrow * 0.4); // Êî∂Á™Ñ
                    if (y < -0.5) v.z *= 0.85; // ‰∏ãÂ∑¥ËÆäÂ∞ñ
                }
                // 2. ÈºªÂ≠ê (Nose)
                if (z > 0 && Math.abs(x) < 0.35 && y > -0.35 && y < 0.35) {
                    const dist = Math.sqrt(x*x + (y+0.1)*(y+0.1));
                    if (dist < 0.35) {
                        const pull = Math.cos(dist * Math.PI / 0.7);
                        v.z += pull * 0.6; // Â§ßÂäõÊãâÂá∫ÈºªÂ≠ê
                        v.y -= pull * 0.1; // ÈºªÂ∞ñÂæÆ‰∏ãÂãæ
                    }
                }
                // 3. ÁúºÁ™© (Eye Sockets)
                if (z > 0.5 && Math.abs(x) > 0.25 && Math.abs(x) < 0.75 && y > 0.15 && y < 0.5) {
                    v.z -= 0.15; // ÂêëÂÖßÂ£ì
                    v.y -= 0.05;
                }
                // 4. ÁúâÈ™® (Brow Ridge)
                if (z > 0.5 && Math.abs(x) < 0.8 && y > 0.45 && y < 0.65) {
                    v.z += 0.08;
                }

                pos.setXYZ(i, v.x, v.y, v.z);
            }
            
            geometry.computeVertexNormals(); // ÈáçÁÆóÂÖâÁÖß
            const head = new THREE.Mesh(geometry, plasterMat);
            head.castShadow = true; head.receiveShadow = true;
            headGroup.add(head);
        }
        createSculptedHead();

        // Neck (Cylinder)
        const neck = new THREE.Mesh(new THREE.CylinderGeometry(0.7, 0.9, 2.8, 8), plasterMat);
        neck.position.y = -2.4; neck.castShadow = true; neck.receiveShadow = true;
        headGroup.add(neck);

        // --- 3. ENVIRONMENT ---
        const envGroup = new THREE.Group();
        scene.add(envGroup);
        // Floor
        const plane = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), floorMat);
        plane.rotation.x = -Math.PI / 2; plane.position.y = -3.0; plane.receiveShadow = true; envGroup.add(plane);
        // Back Wall
        const backWall = new THREE.Mesh(new THREE.PlaneGeometry(40, 30), wallMat);
        backWall.position.set(0, 10, -4.0); backWall.receiveShadow = true; envGroup.add(backWall);

        // Ambient Light (0.6 - Brighter base)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        // --- 4. MARKERS & GUIDES ---
        const overlayGroup = new THREE.Group();
        const markerGeo = new THREE.SphereGeometry(0.4, 8, 8);
        const keyMarker = new THREE.Mesh(markerGeo, new THREE.MeshBasicMaterial({ color: 0xffffff }));
        const fillMarker = new THREE.Mesh(markerGeo, new THREE.MeshBasicMaterial({ color: 0xffccaa }));
        const rimMarker = new THREE.Mesh(markerGeo, new THREE.MeshBasicMaterial({ color: 0x88ccff }));
        const centerMarker = new THREE.Mesh(new THREE.SphereGeometry(0.5, 8, 8), new THREE.MeshBasicMaterial({ color: 0x555555 }));
        overlayGroup.add(keyMarker, fillMarker, rimMarker, centerMarker);
        scene.add(overlayGroup);

        // Guide Lines on Floor
        function createGuide(color) {
            const gm = new THREE.LineBasicMaterial({ color: color, opacity: 0.6, transparent: true });
            const pts = [new THREE.Vector3(0, -2.9, 0), new THREE.Vector3(0, -2.9, 5)];
            const gl = new THREE.Line(new THREE.BufferGeometry().setFromPoints(pts), gm);
            envGroup.add(gl);
            return gl;
        }
        const guideKey = createGuide(0xffffff);
        const guideFill = createGuide(0xffccaa);
        const guideRim = createGuide(0x4488ff);

        // --- 5. LIGHTS ---
        const lights = {
            // High Intensity Defaults
            key: { obj: createSpot(0xffffff, 5.0), guide: guideKey, marker: keyMarker, az: 45, pol: 30, on: true, intensity: 5.0, temp: 5600, modifier: 'softbox' },
            fill: { obj: createSpot(0xffeedd, 2.0), guide: guideFill, marker: fillMarker, az: -45, pol: 10, on: true, intensity: 2.0, temp: 5600, modifier: 'softbox' },
            rim: { obj: createSpot(0xEBF4FF, 6.0), guide: guideRim, marker: rimMarker, az: 135, pol: 30, on: true, intensity: 6.0, temp: 6600, modifier: 'bare' }
        };

        function createSpot(color, intensity) {
            const l = new THREE.SpotLight(color, intensity);
            l.castShadow = true; l.shadow.mapSize.set(1024, 1024); l.shadow.bias = -0.0001;
            scene.add(l); return l;
        }

        // --- 6. LOGIC & UI ---
        let currentLang = 'zh', currentTarget = 'key';
        const txt = {
            zh: {
                tabKey: "‰∏ªÂÖâ", tabFill: "Ë£úÂÖâ", tabRim: "Ëº™Âªì",
                labelStatus: "ÈõªÊ∫êÈñãÈóú", labelMod: "ÊéßÂÖâÈÖç‰ª∂",
                modSoft: "ÊüîÂÖâÁΩ©", modRadar: "Èõ∑ÈÅîÁΩ©", modGrid: "ËúÇÂ∑¢", modBare: "Ë£∏Ááà",
                labelAz: "Êñπ‰ΩçËßí", labelAlt: "È´òÂ∫¶Ëßí", labelInt: "Ëº∏Âá∫Âº∑Â∫¶", labelTemp: "Ëâ≤Ê∫´ K",
                labelGear: "Â∞àÊ•≠ÊîùÂΩ±Ë£ùÂÇô (AFFILIATE)",
                gear1Title: "Â∞àÊ•≠ÂÖâÂ≠∏ÊùüÂÖâÁ≠í", gear1Desc: "Á≤æÊ∫ñÊéßÂÖâ SHAPING LIGHT",
                gear2Title: "ÈõôËâ≤Ê∫´ËÅöÂÖâÁáà", gear2Desc: "È´òÈ°ØËâ≤ÊÄßÊîùÂΩ±Ê£ö‰∏ªÁáà",
                langBtn: "EN",
                lowKey: "ÊöóË™ø / Ââ™ÂΩ±", lowKeyDesc: "‰∏ªÂÖâÂ∑≤ÈóúÈñâ„ÄÇÈÅ©ÂêàË°®ÁèæÁ•ûÁßòÊÑüÊàñÂâ™ÂΩ±Ëº™Âªì„ÄÇ",
                top: "È†ÇÂÖâ (Top Light)", topDesc: "ÈÅ©ÂêàÂº∑Ë™øËÇåËÇâÁ∑öÊ¢ùÊàñÂâµÈÄ†Êà≤ÂäáÊÄßÈ™∑È´èÁúºÂΩ±„ÄÇ",
                butterfly: "Ëù¥Ëù∂ÂÖâ (Butterfly)", butterflyDesc: "Á∂ìÂÖ∏Â•ΩËêäÂ°¢ÁæéÈ°èÂÖâÔºåÂú®Èºª‰∏ãÂΩ¢ÊàêËù∂ÂΩ¢Èô∞ÂΩ±„ÄÇ",
                rembrandt: "ÂÄ´ÂãÉÊúóÂÖâ (Rembrandt)", rembrandtDesc: "ÊöóÈù¢ËáâÈ†∞ÂΩ¢ÊàêÂÄí‰∏âËßíÂÖâÂçÄÔºåÊúÄÂÖ∑Á´ãÈ´îÊÑüÁöÑËóùË°ì‰ΩàÂÖâ„ÄÇ",
                split: "ÂàÜÂâ≤ÂÖâ (Split)", splitDesc: "ËáâÈÉ®ÊòéÊöóÂêÑÂçäÔºåÂâµÈÄ†Âº∑ÁÉàÊÄßÊ†ºËàáÊà≤ÂäáÂºµÂäõ„ÄÇ",
                loop: "Áí∞ÂΩ¢ÂÖâ (Loop)", loopDesc: "ÈºªÂΩ±ÂêëÂÅ¥ÈÇäÂæÆÂÅèÔºåÊúÄÂÆâÂÖ®ÈÄöÁî®ÁöÑË®™Ë´á/ËÇñÂÉè‰ΩàÂÖâ„ÄÇ",
                custom: "Ê∑∑Âêà‰ΩàÂÖâ", customDesc: "Áï∂ÂâçÁÇ∫Ëá™ÂÆöÁæ©Â§öÁáàÁµÑÂêà„ÄÇ"
            },
            en: {
                tabKey: "KEY", tabFill: "FILL", tabRim: "RIM",
                labelStatus: "POWER STATUS", labelMod: "MODIFIER",
                modSoft: "SOFTBOX", modRadar: "RADAR", modGrid: "GRID", modBare: "BARE",
                labelAz: "AZIMUTH", labelAlt: "ALTITUDE", labelInt: "INTENSITY", labelTemp: "KELVIN",
                labelGear: "RECOMMENDED GEAR",
                gear1Title: "OPTICAL SNOOT", gear1Desc: "PRECISE LIGHT SHAPING",
                gear2Title: "BI-COLOR SPOTLIGHT", gear2Desc: "STUDIO ESSENTIAL",
                langBtn: "‰∏≠",
                lowKey: "LOW KEY", lowKeyDesc: "Main light off. Focus on silhouette.",
                top: "TOP LIGHT", topDesc: "High drama, structure focus.",
                butterfly: "BUTTERFLY", butterflyDesc: "Beauty lighting. Butterfly shadow.",
                rembrandt: "REMBRANDT", rembrandtDesc: "Classic cinematic triangle.",
                split: "SPLIT LIGHT", splitDesc: "High contrast side lighting.",
                loop: "LOOP LIGHT", loopDesc: "Natural, general purpose.",
                custom: "CUSTOM", customDesc: "Unique custom setup."
            }
        };

        const els = {
            azSlider: document.getElementById('azSlider'), polSlider: document.getElementById('polSlider'), 
            intSlider: document.getElementById('intSlider'), tempSlider: document.getElementById('tempSlider'),
            azDisplay: document.getElementById('azDisplay'), polDisplay: document.getElementById('polDisplay'), 
            intDisplay: document.getElementById('intDisplay'), tempDisplay: document.getElementById('tempDisplay'),
            powerSwitch: document.getElementById('powerSwitch'),
            algoTitle: document.getElementById('algoTitle'), algoDesc: document.getElementById('algoDesc'),
            dataAngle: document.getElementById('dataAngle'), dataHeight: document.getElementById('dataHeight'), dataTemp: document.getElementById('dataTemp')
        };

        function kelvinToRGB(k) {
            let r, g, b; k /= 100;
            if (k <= 66) { r = 255; g = k < 6 ? 0 : 99.47 * Math.log(k) - 161.1; b = k <= 19 ? 0 : 138.5 * Math.log(k - 10) - 305; } 
            else { r = 329.7 * Math.pow(k - 60, -0.133); g = 288.1 * Math.pow(k - 60, -0.0755); b = 255; }
            return new THREE.Color(`rgb(${Math.max(0,Math.min(255,Math.round(r)))},${Math.max(0,Math.min(255,Math.round(g)))},${Math.max(0,Math.min(255,Math.round(b)))})`);
        }

        window.selectLight = (id) => {
            currentTarget = id;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab' + id.charAt(0).toUpperCase() + id.slice(1)).classList.add('active');
            updateUI(false);
        };

        window.updateVal = () => {
            const d = lights[currentTarget];
            d.az = parseInt(els.azSlider.value);
            d.pol = parseInt(els.polSlider.value);
            d.intensity = parseFloat(els.intSlider.value);
            d.temp = parseInt(els.tempSlider.value);
            updateUI(true);
        };

        window.toggleLight = () => { lights[currentTarget].on = els.powerSwitch.checked; updateUI(true); };
        window.setModifier = (mod) => { lights[currentTarget].modifier = mod; updateUI(true); };
        
        window.applyPreset = (type) => {
            if (type === 'rembrandt') { setLight('key', 45, 40, 5.0, 5600, 'softbox', true); setLight('fill', -45, 10, 2.0, 5600, 'softbox', true); setLight('rim', 180, 20, 2.0, 5600, 'bare', true); } 
            else if (type === 'butterfly') { setLight('key', 0, 50, 5.0, 5600, 'radar', true); setLight('fill', 0, 0, 2.5, 5600, 'softbox', true); setLight('rim', 180, 40, 3.0, 5600, 'bare', true); } 
            else if (type === 'split') { setLight('key', 90, 10, 6.0, 5600, 'grid', true); setLight('fill', -90, 10, 0.5, 5600, 'softbox', true); setLight('rim', 0, 0, 0, 5600, 'bare', false); }
            updateUI(true);
        }
        function setLight(id, a, p, i, t, m, o) { const d = lights[id]; d.az=a; d.pol=p; d.intensity=i; d.temp=t; d.modifier=m; d.on=o; }

        window.toggleLang = () => { currentLang = currentLang === 'zh' ? 'en' : 'zh'; applyLang(); analyze(); };

        function applyLang() {
            const t = txt[currentLang];
            document.getElementById('tabKey').innerText = t.tabKey; document.getElementById('tabFill').innerText = t.tabFill; document.getElementById('tabRim').innerText = t.tabRim;
            document.getElementById('labelStatus').innerText = t.labelStatus; document.getElementById('labelMod').innerText = t.labelMod;
            document.getElementById('mod-softbox').innerText = t.modSoft; document.getElementById('mod-radar').innerText = t.modRadar; document.getElementById('mod-grid').innerText = t.modGrid; document.getElementById('mod-bare').innerText = t.modBare;
            document.getElementById('labelAz').innerText = t.labelAz; document.getElementById('labelAlt').innerText = t.labelAlt; document.getElementById('labelInt').innerText = t.labelInt; document.getElementById('labelTemp').innerText = t.labelTemp;
            document.getElementById('labelGear').innerText = t.labelGear; document.getElementById('gear1Title').innerText = t.gear1Title; document.getElementById('gear1Desc').innerText = t.gear1Desc; document.getElementById('gear2Title').innerText = t.gear2Title; document.getElementById('gear2Desc').innerText = t.gear2Desc;
            document.getElementById('langBtn').innerText = t.langBtn;
        }

        function updateUI(phys = false) {
            const d = lights[currentTarget];
            if (!phys) {
                els.azSlider.value = d.az; els.polSlider.value = d.pol; els.intSlider.value = d.intensity; els.tempSlider.value = d.temp;
            }
            els.azDisplay.innerText = d.az + "¬∞"; els.polDisplay.innerText = d.pol + "¬∞"; els.intDisplay.innerText = d.intensity; els.tempDisplay.innerText = d.temp;
            els.powerSwitch.checked = d.on;
            document.querySelectorAll('.mod-btn').forEach(b => { if (b.id === 'mod-' + d.modifier) b.classList.add('active'); else b.classList.remove('active'); });
            
            const op = d.on ? '1' : '0.4';
            els.azSlider.parentElement.style.opacity = op; els.polSlider.parentElement.style.opacity = op; els.intSlider.parentElement.style.opacity = op; els.tempSlider.parentElement.style.opacity = op;
            
            if (phys) updateLightPos(currentTarget);
            analyze();
        }

        function updateLightPos(id) {
            const d = lights[id];
            const l = d.obj; const guide = d.guide; const marker = d.marker;
            l.visible = d.on; guide.visible = d.on; marker.visible = d.on;
            l.intensity = d.intensity; l.color = kelvinToRGB(d.temp);

            if(!d.on) return;

            const r = 7; const phi = (90 - d.pol) * (Math.PI / 180); const theta = (d.az + 90) * (Math.PI / 180);
            const lx = -(r * Math.sin(phi) * Math.cos(theta));
            const ly = r * Math.cos(phi);
            const lz = r * Math.sin(phi) * Math.sin(theta);
            l.position.set(lx, ly, lz);
            marker.position.set(lx, ly, lz);

            const guideR = 4;
            const gx = -(guideR * Math.cos(theta)); const gz = guideR * Math.sin(theta);
            const pos = guide.geometry.attributes.position.array;
            pos[0]=0; pos[1]=-2.9; pos[2]=0; pos[3]=gx; pos[4]=-2.9; pos[5]=gz;
            guide.geometry.attributes.position.needsUpdate = true;

            if (d.modifier === 'softbox') { l.angle = 1.2; l.penumbra = 1.0; }
            else if (d.modifier === 'radar') { l.angle = 0.7; l.penumbra = 0.4; }
            else if (d.modifier === 'grid') { l.angle = 0.35; l.penumbra = 0.2; }
            else if (d.modifier === 'bare') { l.angle = 1.2; l.penumbra = 0.05; }
        }

        function analyze() {
            const k = lights.key; const t = txt[currentLang];
            let title = t.custom, desc = t.customDesc;
            if(!k.on) { title = t.lowKey; desc = t.lowKeyDesc; }
            else {
                const az = Math.abs(k.az);
                if(k.pol > 60) { title = t.top; desc = t.topDesc; }
                else if(az < 25 && k.pol > 20) { title = t.butterfly; desc = t.butterflyDesc; }
                else if(az >= 30 && az <= 65) { title = t.rembrandt; desc = t.rembrandtDesc; }
                else if(az > 70) { title = t.split; desc = t.splitDesc; }
                else { title = t.loop; desc = t.loopDesc; }
            }
            els.algoTitle.innerText = title; els.algoDesc.innerText = desc;
            els.dataAngle.innerText = k.az + "¬∞"; els.dataHeight.innerText = k.pol + "¬∞"; els.dataTemp.innerText = k.temp + "K";
        }

        let w, h;
        function animate() {
            requestAnimationFrame(animate);
            headGroup.rotation.y = Math.sin(Date.now() * 0.0005) * 0.05;

            // 1. Main View
            renderer.setViewport(0, 0, w, h); renderer.setScissor(0, 0, w, h);
            overlayGroup.visible = false;
            renderer.render(scene, mainCamera);

            // 2. PIP View
            const pipSize = 140; const pad = 20;
            renderer.setViewport(pad, h - pipSize - pad, pipSize, pipSize);
            renderer.setScissor(pad, h - pipSize - pad, pipSize, pipSize);
            renderer.clearDepth();
            overlayGroup.visible = true;
            renderer.render(scene, topCamera);
        }

        window.addEventListener('resize', onResize);
        function onResize() {
            w = wrapper.clientWidth; h = wrapper.clientHeight;
            mainCamera.aspect = w / h; mainCamera.updateProjectionMatrix();
            renderer.setSize(w, h);
        }

        onResize(); applyLang();
        updateLightPos('key'); updateLightPos('fill'); updateLightPos('rim');
        updateUI(); animate();

    </script>
</body>
</html>
