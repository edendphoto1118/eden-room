<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Sculptor Pro | EDEN LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        serif: ['Cinzel', 'serif'], 
                        mono: ['Space Mono', 'monospace'],
                        zh: ['Shippori Mincho', 'serif'] 
                    },
                    colors: { eden: { gold: '#D4AF37' } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #C0C0C0; overflow-x: hidden; }

        /* UI 層級管理 */
        #ui-layer { position: relative; z-index: 50; pointer-events: none; }
        /* 讓按鈕可點擊 */
        #ui-layer nav, #ui-layer main { pointer-events: auto; }
        
        #canvas-container { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 0; 
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 85%);
        }

        /* 質感滑桿 */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; padding: 15px 0; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; 
            background: #D4AF37; margin-top: -6px; border: 1px solid #000; 
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.8); border-radius: 50%;
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; cursor: pointer; background: #333; }

        /* 按鈕系統 */
        .tab-btn {
            font-family: 'Cinzel', serif; font-size: 11px; letter-spacing: 0.1em; color: #555;
            padding: 12px 0; cursor: pointer; transition: 0.3s; border-bottom: 2px solid transparent; text-align: center; width: 33%;
        }
        .tab-btn.active { color: #D4AF37; border-bottom: 2px solid #D4AF37; text-shadow: 0 0 10px rgba(212,175,55,0.4); }
        
        .mod-btn {
            border: 1px solid #333; color: #777; font-family: 'Space Mono'; font-size: 10px;
            padding: 10px 0; text-align: center; cursor: pointer; transition: all 0.3s; background: #0a0a0a;
        }
        .mod-btn.active { border-color: #D4AF37; background: rgba(212, 175, 55, 0.1); color: #D4AF37; font-weight: bold; }

        /* 開關 */
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider-tg {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333; transition: .4s; border-radius: 20px;
        }
        .slider-tg:before {
            position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px;
            background-color: #888; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider-tg { background-color: #111; border: 1px solid #D4AF37; }
        input:checked + .slider-tg:before { transform: translateX(20px); background-color: #D4AF37; }

        /* 雙語 */
        body.lang-en .text-zh { display: none; }
        body.lang-zh .text-en { display: none; }
        body.lang-zh { font-family: 'Shippori Mincho', serif; letter-spacing: 0.05em; font-weight: 500; }
    </style>
</head>
<body class="flex flex-col min-h-screen lang-en">

    <div id="canvas-container"></div>

    <div id="ui-layer" class="flex flex-col min-h-screen">
        
        <nav class="w-full flex justify-between items-center px-6 py-5 bg-gradient-to-b from-black/80 to-transparent">
            <a href="index.html" class="text-[10px] tracking-[0.2em] text-[#888] hover:text-[#fff] transition-colors font-mono">← EDEN ROOM</a>
            <button onclick="toggleLang()" class="border border-[#333] px-3 py-1 text-[9px] font-mono hover:border-[#D4AF37] hover:text-[#D4AF37] transition-colors text-[#666] bg-black/50 backdrop-blur">
                <span class="text-en">中 / EN</span><span class="text-zh">EN / 中</span>
            </button>
        </nav>

        <div class="flex-grow"></div>

        <main class="w-full max-w-2xl mx-auto px-6 pb-12">
            
            <div class="flex justify-between bg-black/80 backdrop-blur-md border border-[#222] mb-6 rounded-sm">
                <div id="tabKey" class="tab-btn active" onclick="selectLight('key')">
                    <span class="text-en">KEY</span><span class="text-zh">主光</span>
                </div>
                <div id="tabFill" class="tab-btn" onclick="selectLight('fill')">
                    <span class="text-en">FILL</span><span class="text-zh">補光</span>
                </div>
                <div id="tabRim" class="tab-btn" onclick="selectLight('rim')">
                    <span class="text-en">RIM</span><span class="text-zh">輪廓</span>
                </div>
            </div>

            <div id="controlPanel" class="bg-black/80 backdrop-blur-md border border-[#222] p-6 space-y-8 rounded-sm transition-opacity duration-300">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="flex items-center justify-between border-b border-[#333] pb-2">
                        <span class="font-serif text-[10px] text-gray-400 tracking-widest">
                            <span class="text-en">STATUS</span><span class="text-zh">開關狀態</span>
                        </span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="powerSwitch" checked onchange="toggleCurrentLight()">
                            <span class="slider-tg"></span>
                        </label>
                    </div>
                    
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="font-serif text-[10px] text-gray-400 tracking-widest">
                                <span class="text-en">MODIFIER</span><span class="text-zh">控光配件</span>
                            </span>
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <div id="modSoftbox" class="mod-btn active" onclick="setModifier('softbox')"><span class="text-en">SOFT</span><span class="text-zh">柔光</span></div>
                            <div id="modRadar" class="mod-btn" onclick="setModifier('radar')"><span class="text-en">RADAR</span><span class="text-zh">雷達</span></div>
                            <div id="modGrid" class="mod-btn" onclick="setModifier('grid')"><span class="text-en">GRID</span><span class="text-zh">蜂巢</span></div>
                            <div id="modBare" class="mod-btn" onclick="setModifier('bare')"><span class="text-en">BARE</span><span class="text-zh">裸燈</span></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="font-serif text-[10px] text-gray-400 tracking-widest">
                                <span class="text-en">AZIMUTH</span><span class="text-zh">水平位置</span>
                            </span>
                            <span id="azVal" class="font-mono text-[10px] text-[#D4AF37]">45°</span>
                        </div>
                        <input type="range" id="azSlider" min="-180" max="180" step="5" oninput="updatePosition()">
                    </div>
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="font-serif text-[10px] text-gray-400 tracking-widest">
                                <span class="text-en">ALTITUDE</span><span class="text-zh">垂直高度</span>
                            </span>
                            <span id="polVal" class="font-mono text-[10px] text-[#D4AF37]">30°</span>
                        </div>
                        <input type="range" id="polSlider" min="-40" max="90" step="5" oninput="updatePosition()">
                    </div>
                </div>

                <div class="border-t border-[#333] pt-4">
                    <h3 class="font-serif text-[#D4AF37] text-sm tracking-widest mb-1 font-bold" id="lightName">REMBRANDT</h3>
                    <p class="font-zh text-xs text-gray-400 font-light" id="lightDesc">...</p>
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- 語言切換 ---
        let currentLang = 'en';
        function toggleLang() {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            document.body.className = document.body.className.replace(/lang-\w+/, `lang-${currentLang}`);
            analyzeGlobal();
        }

        // --- Three.js 初始化 ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // 微弱霧氣，增加深邃感
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(30, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(0, 0, 7);
        camera.lookAt(0, -0.2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // 高品質軟陰影
        
        // 電影級色調映射
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        
        container.appendChild(renderer.domElement);

        // --- SCULPTED HEAD (程式化雕刻人像) ---
        // 核心技術：使用高精度球體，並透過 Vertex Displacement 修改頂點位置
        
        const headGroup = new THREE.Group();
        scene.add(headGroup);

        // 石膏材質
        const plasterMat = new THREE.MeshStandardMaterial({ 
            color: 0xffffff, 
            roughness: 0.5, // 像未上釉的陶瓷
            metalness: 0.05
        });

        function createSculptedHead() {
            // 1. 基礎高精度球體 (128x128 確保極度平滑)
            const geometry = new THREE.SphereGeometry(1.4, 128, 128);
            
            // 2. 頂點雕刻 (Vertex Sculpting)
            const pos = geometry.attributes.position;
            const v = new THREE.Vector3();

            for (let i = 0; i < pos.count; i++) {
                v.fromBufferAttribute(pos, i);
                
                // 座標標準化
                const x = v.x; const y = v.y; const z = v.z;

                // --- 雕刻邏輯 (Sculpting Logic) ---
                
                // A. 削出臉頰與下巴 (Jawline)
                // 如果是下半部且在兩側，往內推
                if (y < 0.2 && z > 0) {
                    const narrowFactor = Math.max(0, (Math.abs(x) - 0.6)); 
                    v.x *= (1 - narrowFactor * 0.5); // 臉頰變窄
                    if (y < -0.5) v.z *= 0.85; // 下巴變尖
                }

                // B. 拉出鼻子 (Nose)
                // 範圍：Y軸中心，X軸極小，Z軸向前
                if (z > 0 && Math.abs(x) < 0.3 && y > -0.3 && y < 0.3) {
                    const dist = Math.sqrt(x*x + (y+0.1)*(y+0.1)); // 到鼻尖的距離
                    if (dist < 0.3) {
                        const pull = Math.cos(dist * Math.PI / 0.6); // 隆起曲線
                        v.z += pull * 0.5; // 向前拉出
                    }
                }

                // C. 壓出眼窩 (Eye Sockets)
                if (z > 0 && Math.abs(x) > 0.2 && Math.abs(x) < 0.7 && y > 0.1 && y < 0.5) {
                    v.z -= 0.15; // 向內壓
                    v.y -= 0.05; // 稍微向下
                }

                // D. 突出眉骨 (Brow Ridge)
                if (z > 0 && Math.abs(x) < 0.8 && y > 0.4 && y < 0.6) {
                    v.z += 0.08;
                }

                // E. 嘴唇微凸 (Lips)
                if (z > 0 && Math.abs(x) < 0.3 && y > -0.8 && y < -0.4) {
                    v.z += 0.05;
                }

                // 更新頂點
                pos.setXYZ(i, v.x, v.y, v.z);
            }

            // 3. 重新計算光照法線 (Crucial for smooth shading)
            geometry.computeVertexNormals();

            const head = new THREE.Mesh(geometry, plasterMat);
            head.castShadow = true; 
            head.receiveShadow = true;
            headGroup.add(head);

            // 4. 脖子 (圓柱過渡)
            const neckGeo = new THREE.CylinderGeometry(0.65, 0.8, 2.5, 64);
            const neck = new THREE.Mesh(neckGeo, plasterMat);
            neck.position.y = -2;
            neck.castShadow = true; neck.receiveShadow = true;
            headGroup.add(neck);

            // 5. 耳朵 (簡單球體)
            const earGeo = new THREE.SphereGeometry(0.35, 32, 32);
            const earL = new THREE.Mesh(earGeo, plasterMat);
            earL.scale.set(0.5, 1.5, 0.5);
            earL.position.set(-1.3, 0, 0);
            earL.castShadow = true; earL.receiveShadow = true;
            headGroup.add(earL);

            const earR = earL.clone();
            earR.position.set(1.3, 0, 0);
            headGroup.add(earR);
        }

        createSculptedHead();

        // 旋轉一下角度，讓這張臉更有雕塑感
        headGroup.rotation.y = 0.1; 

        // 地板 (霧面黑，吸收光線)
        const planeGeo = new THREE.PlaneGeometry(50, 50);
        const planeMat = new THREE.MeshStandardMaterial({ color: 0x050505, roughness: 1.0 });
        const plane = new THREE.Mesh(planeGeo, planeMat);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = -3.5;
        plane.receiveShadow = true;
        scene.add(plane);

        // 安全環境光 (保證可見)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        // --- 燈光系統 ---
        const lights = {
            key: { 
                obj: createSpotLight(0xffffff, 1.5), 
                az: 45, pol: 30, on: true, name: "KEY", 
                modifier: 'softbox' 
            },
            fill: { 
                obj: createSpotLight(0xffeedd, 0.6), 
                az: -45, pol: 10, on: true, name: "FILL", 
                modifier: 'softbox'
            },
            rim: { 
                obj: createSpotLight(0xffc266, 1.5), 
                az: 135, pol: 30, on: true, name: "RIM", 
                modifier: 'bare'
            }
        };

        function createSpotLight(color, intensity) {
            const light = new THREE.SpotLight(color, intensity);
            light.castShadow = true;
            light.shadow.mapSize.width = 2048; 
            light.shadow.mapSize.height = 2048;
            light.shadow.bias = -0.00005; 
            scene.add(light);
            return light;
        }

        // --- 控制邏輯 ---
        let currentTarget = 'key';

        const azSlider = document.getElementById('azSlider');
        const polSlider = document.getElementById('polSlider');
        const powerSwitch = document.getElementById('powerSwitch');
        const azVal = document.getElementById('azVal');
        const polVal = document.getElementById('polVal');
        const controlPanel = document.getElementById('controlPanel');
        const lightName = document.getElementById('lightName');
        const lightDesc = document.getElementById('lightDesc');

        // Init
        function init() {
            updateAllLights();
            updateUI();
        }

        function updateAllLights() {
            for (const key in lights) {
                applyLightPhysics(lights[key]);
                updateLightTransform(key);
            }
        }

        function selectLight(type) {
            currentTarget = type;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');
            updateUI();
        }

        function setModifier(mod) {
            const data = lights[currentTarget];
            data.modifier = mod;
            applyLightPhysics(data);
            updateUI();
        }

        function applyLightPhysics(data) {
            const light = data.obj;
            const type = data.modifier;
            
            // 物理模擬邏輯
            switch(type) {
                case 'softbox':
                    light.angle = 1.0; light.penumbra = 1.0; 
                    light.shadow.radius = 10; 
                    break;
                case 'radar':
                    light.angle = 0.7; light.penumbra = 0.5; 
                    light.shadow.radius = 4; 
                    break;
                case 'grid':
                    light.angle = 0.4; light.penumbra = 0.2; 
                    light.shadow.radius = 2; 
                    break;
                case 'bare':
                    light.angle = 1.2; light.penumbra = 0.05; 
                    light.shadow.radius = 1; 
                    break;
            }
        }

        function updateUI() {
            const data = lights[currentTarget];
            
            azSlider.value = data.az;
            polSlider.value = data.pol;
            azVal.innerText = `${data.az}°`;
            polVal.innerText = `${data.pol}°`;
            powerSwitch.checked = data.on;

            document.querySelectorAll('.mod-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`mod${data.modifier.charAt(0).toUpperCase() + data.modifier.slice(1)}`).classList.add('active');

            if (data.on) {
                controlPanel.style.opacity = '1';
                controlPanel.style.pointerEvents = 'auto';
            } else {
                controlPanel.style.opacity = '0.5';
                // 保持 Header 開關可點
            }
            
            analyzeGlobal();
        }

        function updatePosition() {
            const data = lights[currentTarget];
            data.az = parseInt(azSlider.value);
            data.pol = parseInt(polSlider.value);
            updateLightTransform(currentTarget);
            updateUI();
        }

        function updateLightTransform(type) {
            const data = lights[type];
            data.obj.visible = data.on;
            if (!data.on) return;

            const r = 6;
            const phi = (90 - data.pol) * (Math.PI / 180);
            const theta = (data.az + 90) * (Math.PI / 180);

            data.obj.position.set(
                -(r * Math.sin(phi) * Math.cos(theta)),
                r * Math.cos(phi),
                r * Math.sin(phi) * Math.sin(theta)
            );
            data.obj.lookAt(0, 0, 0);
        }

        function toggleCurrentLight() {
            const data = lights[currentTarget];
            data.on = powerSwitch.checked;
            updateLightTransform(currentTarget);
            updateUI();
        }

        function analyzeGlobal() {
            const key = lights.key;
            const absAz = Math.abs(key.az);
            let titleEn = "", titleZh = "", descEn = "", descZh = "";

            if (!key.on) {
                if(lights.rim.on) {
                    titleEn = "SILHOUETTE"; titleZh = "剪影光";
                    descEn = "Mysterious outline."; descZh = "神祕輪廓勾勒。";
                } else {
                    titleEn = "LOW KEY"; titleZh = "暗調";
                    descEn = "Dark atmosphere."; descZh = "低光氛圍。";
                }
            } else {
                if (key.pol > 60) {
                    titleEn = "TOP LIGHT"; titleZh = "頂光";
                    descEn = "Dramatic structure."; descZh = "強調結構感。";
                } else if (absAz < 25 && key.pol > 20) {
                    titleEn = "BUTTERFLY"; titleZh = "蝴蝶光";
                    descEn = "Beauty lighting."; descZh = "經典美顏佈光。";
                } else if (absAz >= 30 && absAz <= 70) {
                    titleEn = "REMBRANDT"; titleZh = "倫勃朗光";
                    descEn = "Classic cinematic look."; descZh = "經典油畫/電影光。";
                } else if (absAz > 70) {
                    titleEn = "SPLIT"; titleZh = "分割光";
                    descEn = "High contrast drama."; descZh = "高反差戲劇性。";
                } else {
                    titleEn = "LOOP"; titleZh = "環形光";
                    descEn = "Natural portrait light."; descZh = "自然人像佈光。";
                }
            }

            document.getElementById('lightName').innerText = currentLang === 'en' ? titleEn : titleZh;
            document.getElementById('lightDesc').innerText = currentLang === 'en' ? descEn : descZh;
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        init();
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>
</body>
</html>
