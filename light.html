<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Sculptor | EDEN LAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Shippori+Mincho:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        serif: ['Cinzel', 'serif'], 
                        mono: ['Space Mono', 'monospace'],
                        zh: ['Shippori Mincho', 'serif'] 
                    },
                    colors: { eden: { dark: '#020202', gold: '#C5A059' } },
                    animation: { 'fade-in': 'fadeIn 1.2s ease-out forwards' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #020202; color: #e2e8f0; overflow-x: hidden; 
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            -webkit-font-smoothing: antialiased;
        }

        /* 質感滑桿 */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #C5A059; cursor: pointer; margin-top: -6px;
            box-shadow: 0 0 10px rgba(197, 160, 89, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 2px; cursor: pointer; background: #333; border-radius: 2px;
        }
        
        .glass-panel { 
            background: rgba(5, 5, 5, 0.8); border: 1px solid #151515; backdrop-filter: blur(10px);
        }

        #canvas-container {
            width: 100%; height: 50vh; position: relative;
            background: radial-gradient(circle at center, #111 0%, #020202 70%);
            border-bottom: 1px solid #151515;
        }

        /* 燈光開關按鈕 (Toggle) */
        .light-btn {
            border: 1px solid #333; background: #0a0a0a; color: #666;
            font-family: 'Space Mono', monospace; font-size: 10px; letter-spacing: 0.1em;
            padding: 8px 0; text-align: center; cursor: pointer; transition: all 0.3s;
            user-select: none;
        }
        .light-btn.active {
            border-color: #C5A059; background: rgba(197, 160, 89, 0.1); color: #C5A059;
            box-shadow: 0 0 15px rgba(197, 160, 89, 0.1);
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen pb-12">

    <header class="w-full text-center py-6 border-b border-[#111] animate-fade-in relative z-20 bg-[#020202]">
        <a href="index.html" class="block text-[10px] tracking-[0.3em] text-gray-600 hover:text-[#C5A059] mb-2 transition-colors">← EDEN ROOM</a>
        <h1 class="font-serif text-[#C5A059] text-xl tracking-[0.2em]">THE LIGHT SCULPTOR</h1>
        <p class="font-zh text-gray-500 text-[10px] tracking-widest mt-1">三點佈光模擬系統</p>
    </header>

    <div id="canvas-container" class="animate-fade-in">
        <div class="absolute bottom-4 left-0 w-full text-center pointer-events-none z-10">
            <p class="font-mono text-[9px] text-gray-600 tracking-[0.3em] uppercase">Interactive 3D Render</p>
        </div>
    </div>

    <main class="w-full max-w-lg px-8 py-8 space-y-8 animate-fade-in" style="animation-delay: 0.2s;">
        
        <div>
            <div class="flex justify-between items-end mb-3">
                <h3 class="font-serif text-[#C5A059] text-xs tracking-widest">LIGHT MIXER</h3>
                <span class="font-mono text-[9px] text-gray-500">STUDIO CONTROLS</span>
            </div>
            <div class="grid grid-cols-3 gap-3">
                <div id="btnKey" class="light-btn active" onclick="toggleLight('key')">KEY [主光]</div>
                <div id="btnFill" class="light-btn active" onclick="toggleLight('fill')">FILL [補光]</div>
                <div id="btnRim" class="light-btn active" onclick="toggleLight('rim')">RIM [輪廓]</div>
            </div>
        </div>

        <div id="positionControls" class="space-y-6 transition-opacity duration-300">
            <div>
                <div class="flex justify-between mb-2">
                    <label class="font-mono text-[9px] text-gray-400 tracking-widest">KEY POSITION (方位)</label>
                    <span id="angleDisplay" class="font-mono text-[9px] text-[#C5A059]">0°</span>
                </div>
                <input type="range" id="azimuthSlider" min="-180" max="180" value="0" step="1">
            </div>
            <div>
                <div class="flex justify-between mb-2">
                    <label class="font-mono text-[9px] text-gray-400 tracking-widest">KEY HEIGHT (高度)</label>
                    <span class="font-mono text-[9px] text-[#C5A059]">Y-AXIS</span>
                </div>
                <input type="range" id="polarSlider" min="-20" max="90" value="20" step="1">
            </div>
        </div>

        <div class="glass-panel p-6 border-l-2 border-[#C5A059]">
            <h2 id="lightName" class="font-zh text-lg text-white mb-2 tracking-wide font-medium">初始化中...</h2>
            <p id="lightDesc" class="font-zh text-xs text-gray-400 leading-relaxed text-justify font-light opacity-80">
                正在計算光照角度與陰影結構...
            </p>
        </div>

        <div class="text-center pt-4 border-t border-[#111]">
            <a href="https://www.instagram.com/eden_d_photo/" target="_blank" class="block w-full py-4 bg-[#111] border border-[#222] text-[#C5A059] font-mono text-xs tracking-[0.2em] hover:bg-[#C5A059] hover:text-black transition-colors">
                BOOK A SESSION ↗
            </a>
        </div>
    </main>

    <script>
        // --- Three.js Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020202, 0.02);

        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.z = 5.5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Geometry (Abstract Head) ---
        const geometry = new THREE.IcosahedronGeometry(1.4, 1);
        const material = new THREE.MeshStandardMaterial({ 
            color: 0xffffff, roughness: 0.7, metalness: 0.1, flatShading: true 
        });
        const bust = new THREE.Mesh(geometry, material);
        bust.castShadow = true; bust.receiveShadow = true;
        scene.add(bust);

        const planeGeo = new THREE.PlaneGeometry(20, 20);
        const planeMat = new THREE.MeshStandardMaterial({ color: 0x050505, roughness: 0.9 });
        const plane = new THREE.Mesh(planeGeo, planeMat);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = -2;
        plane.receiveShadow = true;
        scene.add(plane);

        // --- Lighting System (Three-Point) ---
        
        // 1. Key Light (主光 - 可動)
        const keyLight = new THREE.SpotLight(0xffffff, 1.2);
        keyLight.castShadow = true;
        keyLight.shadow.mapSize.width = 1024;
        keyLight.shadow.mapSize.height = 1024;
        keyLight.shadow.bias = -0.0001;
        scene.add(keyLight);

        // 2. Fill Light (補光 - 固定左前柔光)
        const fillLight = new THREE.DirectionalLight(0xffeedd, 0.4); // 暖色補光
        fillLight.position.set(-3, 1, 4); 
        scene.add(fillLight);

        // 3. Rim Light (輪廓光 - 固定後方冷光)
        const rimLight = new THREE.SpotLight(0x4466ff, 1.5); // 藍色輪廓
        rimLight.position.set(3, 4, -4);
        rimLight.lookAt(0,0,0);
        scene.add(rimLight);

        // Ambient (基礎環境光)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.05);
        scene.add(ambientLight);

        // --- State Management ---
        const state = {
            key: true,
            fill: true,
            rim: true
        };

        const azSlider = document.getElementById('azimuthSlider');
        const polSlider = document.getElementById('polarSlider');
        const lightName = document.getElementById('lightName');
        const lightDesc = document.getElementById('lightDesc');
        const angleDisplay = document.getElementById('angleDisplay');
        const posControls = document.getElementById('positionControls');

        // Toggle Logic
        function toggleLight(type) {
            state[type] = !state[type];
            const btn = document.getElementById(`btn${type.charAt(0).toUpperCase() + type.slice(1)}`);
            
            // UI Update
            if (state[type]) btn.classList.add('active');
            else btn.classList.remove('active');

            // Light Update
            if (type === 'key') {
                keyLight.visible = state[type];
                // 如果關掉主光，禁用滑桿並變暗
                if(!state[type]) posControls.style.opacity = '0.3';
                else posControls.style.opacity = '1';
                analyzeLighting(); // Update text
            }
            if (type === 'fill') fillLight.visible = state[type];
            if (type === 'rim') rimLight.visible = state[type];
        }

        // Update Key Light Position
        function updateKeyLight() {
            if (!state.key) {
                lightName.innerText = "主光已關閉 (Key Off)";
                lightDesc.innerText = "目前僅依賴補光或輪廓光。畫面缺乏主導性的陰影結構，立體感較弱。請開啟 KEY Light 以進行佈光設計。";
                return;
            }

            const az = parseInt(azSlider.value);
            const pol = parseInt(polSlider.value);
            const r = 5.5;
            const phi = (90 - pol) * (Math.PI / 180);
            const theta = (az + 90) * (Math.PI / 180);

            keyLight.position.set(
                -(r * Math.sin(phi) * Math.cos(theta)),
                r * Math.cos(phi),
                r * Math.sin(phi) * Math.sin(theta)
            );
            keyLight.lookAt(0, 0, 0);

            angleDisplay.innerText = `${az}° / ${pol}°`;
            analyzeLighting(az, pol);
        }

        // Analysis Logic
        function analyzeLighting(az, pol) {
            if (!state.key) return; // Handled in updateKeyLight
            
            // Re-fetch slider values if not provided (for toggle update)
            if (az === undefined) az = parseInt(azSlider.value);
            if (pol === undefined) pol = parseInt(polSlider.value);

            const absAz = Math.abs(az);

            if (pol > 60) {
                setInfo("頂光 (Top Light)", "來自正上方的光線，在眼窩形成深重陰影。這種光線極具壓迫感，常能在建築中創造神聖性，但在人像上容易顯得兇狠。");
            } else if (pol < -5) {
                setInfo("底光 (Under Light)", "俗稱鬼光。反自然的照明方向，破壞面部正常結構，產生詭異與不安的視覺感受。");
            } else {
                if (absAz < 20) {
                    if (pol > 25) setInfo("蝴蝶光 (Butterfly)", "好萊塢經典佈光。在鼻下形成蝴蝶狀陰影，能強調顴骨結構，使臉型更加精緻、顯瘦。");
                    else setInfo("正面平光 (Flat Light)", "光線直射面部，陰影最少。皮膚看起來最平滑，但建築結構感與立體度也隨之消失。");
                } else if (absAz >= 30 && absAz <= 60 && pol > 20) {
                    setInfo("倫勃朗光 (Rembrandt)", "EDEND 推薦。暗面臉頰形成倒三角光區。這是繪畫與攝影中最具藝術性與故事感的佈光方式。");
                } else if (absAz >= 80 && absAz <= 110) {
                    setInfo("分割光 (Split)", "正側面光，將面孔一分為二。創造最強烈的明暗對比（Chiaroscuro），極具戲劇性與陽剛氣質。");
                } else if (absAz > 110) {
                    setInfo("邊緣光 (Kicker / Rim)", "光線滑過面部邊緣，正面幾乎全黑。適合強調輪廓線條，創造神秘與隱晦的氛圍。");
                } else {
                    setInfo("環形光 (Loop)", "鼻影微微偏向一側。這是最通用、最自然的佈光方式，保留了立體感且不過於戲劇化。");
                }
            }
        }

        function setInfo(title, desc) {
            lightName.innerText = title;
            lightDesc.innerText = desc;
        }

        azSlider.addEventListener('input', updateKeyLight);
        polSlider.addEventListener('input', updateKeyLight);

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            // 讓輪廓光微微移動，展示光澤感
            if (state.rim) {
                rimLight.position.x = 3 + Math.sin(Date.now() * 0.001) * 2;
                rimLight.lookAt(0,0,0);
            }
            renderer.render(scene, camera);
        }
        animate();
        updateKeyLight(); // Init

        // RWD
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>
</body>
</html>
